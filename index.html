<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <title>ç‰¹å¾µé¸å–ç³»çµ±</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            color: #333;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        h2, h3 {
            color: #2c3e50;
            text-align: center;
        }
        h2 {
            margin-bottom: 20px;
            font-size: 2em;
        }
        h3 {
            font-size: 1.5em;
            margin-top: 15px;
            margin-bottom: 10px;
        }
        form {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }
        th {
            background-color: #3498db;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        input[type="file"] {
            margin-right: 10px;
        }
        ul {
            list-style-type: none;
            padding-left: 0;
        }
        li {
            background: #ecf0f1;
            margin: 5px 0;
            padding: 10px;
            border-radius: 5px;
        }
        @media (max-width: 600px) {
            table, thead, tbody, th, td, tr {
                display: block;
            }
            th {
                text-align: center;
            }
            td {
                text-align: right;
                position: relative;
                padding-left: 50%;
            }
            td:before {
                content: attr(data-label);
                position: absolute;
                left: 10px;
                font-weight: bold;
            }
        }
    </style>
    <script>
        // ç”¨æ–¼å•Ÿç”¨/ç¦ç”¨åŒ¯å‡ºæŒ‰éˆ•
        function updateExportButton() {
            const checkboxes = document.querySelectorAll('input[name="selected_features"]:checked');
            const exportBtn = document.getElementById('exportBtn');
            exportBtn.disabled = checkboxes.length === 0;
        }

        // é é¢è¼‰å…¥å¾Œç¶å®šç›£è½
        window.onload = function() {
            const checkboxes = document.querySelectorAll('input[name="selected_features"]');
            checkboxes.forEach(chk => {
                chk.addEventListener('change', updateExportButton);
            });
            updateExportButton(); // åˆå§‹åŒ–ç‹€æ…‹
        };
    </script>
</head>
<body>
    <h2>ğŸ“Š ç‰¹å¾µæ¬„ä½é¸å–</h2>

    <!-- CSV ä¸Šå‚³ -->
    <form method="post" enctype="multipart/form-data">
        <label>ğŸ“ ä¸Šå‚³ CSV æª”ï¼š</label>
        <input type="file" name="csv_file" accept=".csv" required>
        <button type="submit" name="action" value="upload">ä¸Šå‚³ CSV</button>
    </form>

    <br />

    <!-- å·²é¸å–çš„ç‰¹å¾µèˆ‡åŒ¯å‡ºæŒ‰éˆ• -->
    {% if selected %}
        <h3>âœ… ä½ å·²é¸å–çš„ç‰¹å¾µï¼š</h3>
        <ul>
        {% for name in selected %}
            <li>{{ name }}</li>
        {% endfor %}
        </ul>
        <!-- åŒ¯å‡ºè¡¨å–® -->
        <form method="post" id="exportForm" onsubmit="return confirmExport()">
            <!-- å°‡å‹¾é¸æ¬„ä½ç”¨éš±è—æ¬„ä½å¸¶å…¥ -->
            {% for name in selected %}
                <input type="hidden" name="selected_features" value="{{ name }}">
            {% endfor %}
            <button type="submit" name="action" value="export" id="exportBtn">ğŸ“¤ åŒ¯å‡ºé¸å–æ¬„ä½ CSV</button>
        </form>
        <br />
    {% endif %}

    <!-- æ¬„ä½å‹¾é¸è¡¨å–® -->
    <form method="post" id="selectForm">
        {% for layer, features in features_by_layer.items() %}
            <h3>ğŸ“ å±¤ç´šï¼š{{ layer }}</h3>
            <table border="1" cellpadding="5" cellspacing="0">
                <thead>
                    <tr>
                        <th>âœ”ï¸ å‹¾é¸</th>
                        <th>è‹±æ–‡æ¬„ä½</th>
                        <th>ä¸­æ–‡åç¨±</th>
                        <th>é¡åˆ¥</th>
                    </tr>
                </thead>
                <tbody>
                {% for feature in features %}
                    <tr>
                        <td>
                            <input type="checkbox" name="selected_features" value="{{ feature.name }}"
                                   {% if feature.name in selected %}checked{% endif %}>
                        </td>
                        <td>{{ feature.name }}</td>
                        <td>{{ feature.chinese }}</td>
                        <td>{{ feature.type }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            <br />
        {% endfor %}

        <button type="submit" name="action" value="select">é€å‡ºé¸å–</button>
    </form>

<script>
    function confirmExport() {
        const exportBtn = document.getElementById('exportBtn');
        if (exportBtn.disabled) {
            alert('è«‹å…ˆå‹¾é¸è‡³å°‘ä¸€å€‹æ¬„ä½æ‰èƒ½åŒ¯å‡ºï¼');
            return false;
        }
        return confirm('ç¢ºå®šè¦åŒ¯å‡ºé¸å–çš„æ¬„ä½å—ï¼Ÿ');
    }
</script>

</body>
</html>